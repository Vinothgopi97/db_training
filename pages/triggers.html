<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Triggers in MySQL</title>
  <link rel="stylesheet" href="../css/styles.css">
</head>
<body class="has-sidebar">
    <div class="container">
    <nav class="sidebar">
      <ol>
        <li><a href="../index.html">Home</a></li>
        <li><a href="basic-concepts.html">Basic Concepts</a></li>
        <li><a href="relational-model.html">Relational Model</a></li>
        <li><a href="sql-basics.html">SQL Basics</a></li>
  <li><a href="postgresql-intro.html">MySQL Introduction</a></li>
        <li><a href="data-types.html">Data Types</a></li>
        <li><a href="constraints.html">Constraints</a></li>
        <li><a href="relationships.html">Relationships</a></li>
        <li><a href="queries.html">Queries</a></li>
        <li><a href="joins-deep.html">Joins (Deep Dive)</a></li>
        <li><a href="keys.html">Keys</a></li>
        <li><a href="transactions.html">Transactions & ACID</a></li>
        <li><a href="indexing.html">Indexing & Performance</a></li>
  <li><a href="advanced-postgres.html">Advanced MySQL</a></li>
      </ol>
    </nav>
      <div class="nav-buttons">
        <a class="btn" href="transactions.html">Next: Transactions & ACID</a>
      </div>
    </div>
    <script>
      (function(){
        var links = document.querySelectorAll('.sidebar a');
        if(!links) return;
        var path = location.pathname || '';
        var currentFile = path.split('/').pop() || 'index.html';
        if (!currentFile) currentFile = 'index.html';
        links.forEach(function(a){
          try{
            var href = a.getAttribute('href') || '';
            var hrefFile = href.split('/').pop() || '';
            if (hrefFile === '') hrefFile = 'index.html';
            if (hrefFile === currentFile) {
              a.classList.add('active');
              a.setAttribute('aria-current','page');
            }
          } catch(e){}
        });
      })();
    </script>
  </div>
  </body>
</html>
      <h2>Trigger Timing</h2>
      <ul>
        <li><strong>BEFORE</strong> — Fire before the event (can modify the incoming row).</li>
        <li><strong>AFTER</strong> — Fire after the event (cannot modify the row being written; good for logging or cascading actions).</li>
        <li><strong>INSTEAD OF</strong> — Used with views to fire instead of the event.</li>
      </ul>

      <h2>Row vs Statement Triggers</h2>
      <ul>
        <li><strong>FOR EACH ROW</strong> — Trigger fires once per row affected.</li>
        <li><strong>FOR EACH STATEMENT</strong> — Trigger fires once per statement, regardless of how many rows are affected.</li>
      </ul>

      <h2>Example: Audit Trigger</h2>
      <div class="example">
        <code>
          CREATE TABLE users (id INT AUTO_INCREMENT PRIMARY KEY, name VARCHAR(255), email VARCHAR(255));
          CREATE TABLE users_audit (id INT AUTO_INCREMENT PRIMARY KEY, user_id INT, changed_by VARCHAR(255), changed_at DATETIME, action VARCHAR(255));

          -- Trigger function (plpgsql)
          CREATE OR REPLACE FUNCTION audit_user_changes()
          RETURNS TRIGGER AS $$
          BEGIN
            IF TG_OP = 'INSERT' THEN
              INSERT INTO users_audit (user_id, changed_by, changed_at, action)
              VALUES (NEW.id, current_user, now(), 'INSERT');
              RETURN NEW;
            ELSIF TG_OP = 'UPDATE' THEN
              INSERT INTO users_audit (user_id, changed_by, changed_at, action)
              VALUES (NEW.id, current_user, now(), 'UPDATE');
              RETURN NEW;
            ELSIF TG_OP = 'DELETE' THEN
              INSERT INTO users_audit (user_id, changed_by, changed_at, action)
              VALUES (OLD.id, current_user, now(), 'DELETE');
              RETURN OLD;
            END IF;
            RETURN NULL;
          END;
          $$ LANGUAGE plpgsql;

          -- Attach trigger
          CREATE TRIGGER trg_audit_users
          AFTER INSERT OR UPDATE OR DELETE ON users
          FOR EACH ROW EXECUTE FUNCTION audit_user_changes();
        </code>
      </div>

      <h2>When to Use Triggers</h2>
      <ul>
        <li>Audit logging or history tables.</li>
        <li>Enforcing complex integrity rules not easily expressed with constraints.</li>
        <li>Synchronizing denormalized data.</li>
        <li>Automatically updating related tables.</li>
      </ul>

      <h2>Precautions</h2>
      <ul>
        <li>Triggers can hide side-effects and make debugging harder—document them well.</li>
        <li>Long-running trigger code can hurt write performance.</li>
        <li>Avoid heavy I/O in triggers; prefer asynchronous processing (e.g., background worker) for expensive tasks.</li>
      </ul>
      <div class="nav-buttons">
        <a class="btn" href="transactions.html">Next: Transactions & ACID</a>
      </div>
    </div>
  </div>
</body>
</html>